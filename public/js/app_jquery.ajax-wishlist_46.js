;(function($,window,undefined){'use strict';$.plugin('swAjaxWishlist',{defaults:{counterSelector:'.notes--quantity',wishlistSelector:'.entry--notepad',iconCls:'icon--check',savedCls:'js--is-saved',text:'Gemerkt',delay:1500},init:function(){var me=this;me.applyDataAttributes();me.$wishlistButton=$(me.opts.wishlistSelector);me.$counter=$(me.opts.counterSelector);me.registerEvents();},registerEvents:function(){var me=this;me.$el.on(me.getEventName('click'),'.action--note, .link--notepad',$.proxy(me.triggerRequest,me));$.publish('plugin/swAjaxWishlist/onRegisterEvents',[me]);},triggerRequest:function(event){var me=this,$target=$(event.currentTarget),url=$target.attr('data-ajaxUrl');if(url==undefined||$target.hasClass(me.opts.savedCls)){return;}
event.preventDefault();$.ajax({'url':url,'dataType':'jsonp','success':$.proxy(me.responseHandler,me,$target)});$.publish('plugin/swAjaxWishlist/onTriggerRequest',[me,event,url]);},responseHandler:function($target,json){var me=this,response=JSON.parse(json);$.publish('plugin/swAjaxWishlist/onTriggerRequestLoaded',[me,$target,response]);if(!response.success){return;}
me.updateCounter(response.notesCount);me.animateElement($target);$.publish('plugin/swAjaxWishlist/onTriggerRequestFinished',[me,$target,response]);},animateElement:function($target){var me=this,$icon=$target.find('i'),originalIcon=$icon[0].className,$text=$target.find('.action--text'),originalText=$text.html();$target.addClass(me.opts.savedCls);$text.html($target.attr('data-text')||me.opts.text);$icon.removeClass(originalIcon).addClass(me.opts.iconCls);window.setTimeout(function(){$target.removeClass(me.opts.savedCls);$text.html(originalText);$icon.removeClass(me.opts.iconCls).addClass(originalIcon);$.publish('plugin/swAjaxWishlist/onAnimateElementFinished',[me,$target]);},me.opts.delay);$.publish('plugin/swAjaxWishlist/onAnimateElement',[me,$target]);},updateCounter:function(count){var me=this,$btn=me.$wishlistButton,animate='transition';if(me.$counter.length){me.$counter.html(count);return me.$counter;}
me.$counter=$('<span>',{'class':'badge notes--quantity','html':count,'css':{'opacity':0}}).appendTo($btn.find('a'));if(!$.support.transition){animate='animate';}
me.$counter[animate]({'opacity':1},500);$.publish('plugin/swAjaxWishlist/onUpdateCounter',[me,me.$counter,count]);return me.$counter;},destroy:function(){var me=this;me.$el.off(me.getEventName('click'));}});})(jQuery,window);