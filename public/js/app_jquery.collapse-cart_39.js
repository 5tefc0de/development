;(function($,window){'use strict';$.plugin('swCollapseCart',{defaults:{'ajaxCartURL':window.controller['ajax_cart'],'ajaxRemoveLineItemURL':window.controller['ajax_remove_item'],'triggerElSelector':'.navigation--entry.entry--cart','itemContainerSelector':'.item--container','removeItemSelector':'.action--remove','offcanvasCloseElSelector':'.close--off-canvas','loadingIconClass':'icon--loading-indicator','loadingIconWrapperClass':'ajax--cart','activeClass':'is--shown','displayMode':'collapsible'},init:function(){var me=this,opts;me.applyDataAttributes();opts=me.opts;me._$triggerEl=$(opts.triggerElSelector);me._$linkEl=me._$triggerEl.find('.cart--link');me._isOverMe=false;me._isCartLoading=false;me._$loadingIcon=$('<i>',{'class':opts.loadingIconClass});me._isOpened=false;if(me.isDisplayMode('offcanvas')){me._$triggerEl.swOffcanvasMenu({'offCanvasSelector':me.$el,'direction':'fromRight'});}
me.registerEvents();},registerEvents:function(){var me=this;me.$el.on(me.getEventName('click'),me.opts.removeItemSelector,$.proxy(me.onRemoveButtonClick,me));me.$el.on(me.getEventName('click touchstart'),me.opts.offcanvasCloseElSelector,$.proxy(me.onCloseButtonClick,me));if(me.isDisplayMode('offcanvas')){me._on(me._$triggerEl,'click touchstart',$.proxy(me.onMouseEnter,me));$.subscribe('plugin/swAddArticle/onAddArticle',$.proxy(me.onArticleAdded,me));$.subscribe('plugin/swAddArticle/onBeforeAddArticle',$.proxy(me.onBeforeAddArticle,me));}else{me._on('.container--ajax-cart,'+me.opts.triggerElSelector,'mousemove',$.proxy(me.onMouseHover,me));me._on(me._$triggerEl,'mouseenter touchstart',$.proxy(me.onMouseEnter,me));me._on(me._$triggerEl,'mouseleave',$.proxy(me.onMouseLeave,me));me._on(me._$triggerEl,'click',$.proxy(me.onClick,me));me._on(me.$el,'mouseleave',$.proxy(me.onMouseLeave,me));$('.container--ajax-cart,'+me.opts.triggerElSelector).hover($.proxy(me.onMouseHoverStart,me),$.proxy(me.onMouseHoverEnd,me));}
$.publish('plugin/swCollapseCart/onRegisterEvents',[me]);},onBeforeAddArticle:function(){var me=this;me.showLoadingIndicator();me.openMenu();$.publish('plugin/swCollapseCart/onBeforeAddArticle',[me]);},onArticleAdded:function(event,plugin,response){var me=this;if(me.isDisplayMode('collapsible')){return;}
me.$el.html(response).find('.ajax--cart .alert').removeClass('is--hidden');picturefill();$.publish('plugin/swCollapseCart/onArticleAdded',[me]);},onMouseEnter:function(event){var me=this;if(me.isDisplayMode('offcanvas')){event.preventDefault();me.showLoadingIndicator();me.openMenu();me.loadCart();}else{if(me.isCartLoading()){me.showLoadingIndicator();me.openMenu();}else{me.buffer(function(){if(me.isOverMe()===false||me._wasClicked===true){return;}
me.showLoadingIndicator();me.openMenu();me.loadCart(function(){$('body').one('touchstart',$.proxy(me.onMouseLeave,me));$.publish('plugin/swCollapseCart/onMouseEnterLoaded',[me,event]);});$.publish('plugin/swCollapseCart/onMouseEnterBuffer',[me,event]);},500);}}
$.publish('plugin/swCollapseCart/onMouseEnter',[me,event]);},onMouseLeave:function(event){var me=this,target=event.toElement||event.relatedTarget||event.target;$.publish('plugin/swCollapseCart/onMouseLeave',[me,event]);if(me.isElementOrChild(me.$el[0],target)||me.isElementOrChild(me._$triggerEl[0],target)){return;}
me.closeMenu();me.clearBuffer();},onCloseButtonClick:function(event){event.preventDefault();$.publish('plugin/swCollapseCart/onCloseButton',[this]);this.closeMenu();},onRemoveButtonClick:function(event){event.preventDefault();var me=this,opts=me.opts,$currentTarget=$(event.currentTarget),$parent=$currentTarget.parent(),identifier;$.publish('plugin/swCollapseCart/onRemoveArticle',[me,event]);$parent.html(me._$loadingIcon.clone());identifier=$currentTarget.data('identifier');$.ajax({'url':opts.ajaxRemoveLineItemURL,'method':'POST','dataType':'html','data':{'identifier':identifier},'success':function(result){me.$el.html(result);picturefill();$.publish('plugin/swCollapseCart/onRemoveArticleFinished',[me,event,result]);}});},buffer:function(func,bufferTime){var me=this;me.clearBuffer();me.bufferTimeout=setTimeout(func,bufferTime);},clearBuffer:function(){var me=this;if(me.bufferTimeout){clearTimeout(me.bufferTimeout);}},isElementOrChild:function(firstEl,secondEl){return firstEl===secondEl||$.contains(firstEl,secondEl);},isDisplayMode:function(mode){return this.opts.displayMode===mode;},showLoadingIndicator:function(){var me=this;me.$el.html($('<div>',{'class':me.opts.loadingIconWrapperClass,'html':me._$loadingIcon.clone()}));$.publish('plugin/swCollapseCart/onShowLoadingIndicator',[me]);},openMenu:function(){var me=this,plugin;me._isOpened=true;if(me.isDisplayMode('offcanvas')&&(plugin=me._$triggerEl.data('plugin_swOffcanvasMenu'))){plugin.openMenu();}else{me.$el.addClass(me.opts.activeClass);}
$.publish('plugin/swCollapseCart/onMenuOpen',[me]);},loadCart:function(callback){var me=this,opts=me.opts,$el=me.$el;if(me.isCartLoading()){return;}
$.publish('plugin/swCollapseCart/onLoadCart',[me]);me._$linkEl.addClass('is--disabled');me._isCartLoading=true;$.ajax({'url':opts.ajaxCartURL,'method':'POST','dataType':'html','success':function(result){$el.html(result);picturefill();$.publish('plugin/swCollapseCart/onLoadCartFinished',[me,result]);},'complete':function(){me._$linkEl.removeClass('is--disabled');me._isCartLoading=false;}});},closeMenu:function(){var me=this,plugin;me._isOpened=false;if(me.isDisplayMode('offcanvas')&&(plugin=me._$triggerEl.data('plugin_swOffcanvasMenu'))){plugin.closeMenu();}else{me.$el.removeClass(me.opts.activeClass);}
$.publish('plugin/swCollapseCart/onCloseMenu',[me]);},onClick:function(event){var me=this;if(me.isCartLoading()){event.preventDefault();return false;}
me._wasClicked=true;},isCartLoading:function(){return!!this._isCartLoading;},isOverMe:function(){return!!this._isOverMe;},onMouseHoverStart:function(){this._isOverMe=true;},onMouseHoverEnd:function(){this._isOverMe=false;},destroy:function(){var me=this;me.off(me.eventSuffix);me._destroy();}});})(jQuery,window);