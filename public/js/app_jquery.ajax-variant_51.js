;(function($,window){$.plugin('swAjaxVariant',{hasHistorySupport:Modernizr.history,initialPopState:true,defaults:{productDetailsSelector:'.product--detail-upper',configuratorFormSelector:'.configurator--form',canonicalUrlSelector:'.canonical-url',orderNumberSelector:'.entry--sku .entry--content',historyIdentifier:'sw-ajax-variants',productDetailsDescriptionSelector:'.content--description',footerJavascriptInlineSelector:'#footer--js-inline'},init:function(){var me=this,ie;if(!me.$el.find('.product--configurator').length){return;}
me.applyDataAttributes();ie=(function(){if(window.ActiveXObject===undefined)return null;if(!document.querySelector)return 7;if(!document.addEventListener)return 8;if(!window.atob)return 9;if(!document.__proto__)return 10;return 11;})();if(ie&&ie<=9){me.hasHistorySupport=false;}
me.$el.on(me.getEventName('click'),'*[data-ajax-variants="true"]',$.proxy(me.onChange,me)).on(me.getEventName('change'),'*[data-ajax-select-variants="true"]',$.proxy(me.onChange,me)).on(me.getEventName('click'),'.reset--configuration',$.proxy(me.onChange,me));$(window).on('popstate',$.proxy(me.onPopState,me));if(me.hasHistorySupport){me.publishInitialState();}},publishInitialState:function(){var me=this,stateObj=me._createHistoryStateObject();window.history.replaceState(stateObj.state,stateObj.title);},requestData:function(values,pushState){var me=this,stateObj=me._createHistoryStateObject();$.loadingIndicator.open({closeOnClick:false,delay:100});$.publish('plugin/swAjaxVariant/onBeforeRequestData',[me,values,stateObj.location]);values.template='ajax';if(stateObj.params.hasOwnProperty('c')){values.c=stateObj.params.c;}
$.ajax({url:stateObj.location,data:values,method:'GET',success:function(response){var $response=$($.parseHTML(response,document,true)),$productDetails,$productDescription,$canonicalUrl,ordernumber;$productDetails=$response.find(me.opts.productDetailsSelector);$(me.opts.productDetailsSelector).html($productDetails.html());$canonicalUrl=$response.find(me.opts.canonicalUrlSelector);if($canonicalUrl){$canonicalUrl=$canonicalUrl.html();}
$productDescription=$response.find(me.opts.productDetailsDescriptionSelector);$(me.opts.productDetailsDescriptionSelector).html($productDescription.html());ordernumber=$.trim(me.$el.find(me.opts.orderNumberSelector).text());window.controller=window.snippets=window.themeConfig=window.lastSeenProductsConfig=window.csrfConfig=null;$(me.opts.footerJavascriptInlineSelector).replaceWith($response.filter(me.opts.footerJavascriptInlineSelector));StateManager.addPlugin('*[data-image-slider="true"]','swImageSlider',{touchControls:true}).addPlugin('.product--image-zoom','swImageZoom','xl').addPlugin('*[data-image-gallery="true"]','swImageGallery').addPlugin('*[data-add-article="true"]','swAddArticle').addPlugin('*[data-modalbox="true"]','swModalbox');$.publish('plugin/swAjaxVariant/onRequestData',[me,response,values,stateObj.location]);if(pushState&&me.hasHistorySupport){var location=stateObj.location+'?number='+ordernumber;if(stateObj.params.hasOwnProperty('c')){location+='&c='+stateObj.params.c;}
window.history.pushState(stateObj.state,stateObj.title,$canonicalUrl);}},complete:function(){$.loadingIndicator.close();}});},onPopState:function(event){var me=this,state=event.originalEvent.state;if(!state||!state.hasOwnProperty('type')||state.type!=='sw-ajax-variants'){return;}
if($('html').hasClass('is--safari')&&me.initialPopState){me.initialPopState=false;return;}
if(!state.values.length){state='';}
if(state&&state.scrollPos){window.setTimeout(function(){$(window).scrollTop(state.scrollPos);},10);}
$.publish('plugin/swAjaxVariant/onPopState',[me,state]);me.requestData(state.values,false);},onChange:function(event){var me=this,$target=$(event.target),$form=$target.parents('form'),values={};$.each($form.serializeArray(),function(i,item){if(item.name==='__csrf_token'){return;}
values[item.name]=item.value;});event.preventDefault();if(!me.hasHistorySupport){$.loadingIndicator.open({closeOnClick:false,delay:0});$form.submit();return false;}
$.publish('plugin/swAjaxVariant/onChange',[me,values,$target]);me.requestData(values,true);},_getUrlParams:function(){var search=window.location.search.substring(1),urlParams=search.split('&'),params={};$.each(urlParams,function(i,param){param=param.split('=');if(param[0].length&&param[1].length&&!params.hasOwnProperty(param[0])){params[decodeURIComponent(param[0])]=decodeURIComponent(param[1]);}});return params;},_getUrl:function(){return window.location.protocol+'//'+window.location.host+window.location.pathname;},_createHistoryStateObject:function(){var me=this,$form=me.$el.find(me.opts.configuratorFormSelector),urlParams=me._getUrlParams(),location=me._getUrl();return{state:{type:me.opts.historyIdentifier,values:$form.serialize(),scrollPos:$(window).scrollTop()},title:document.title,location:location,params:urlParams};}});})(jQuery,window);