;(function($){'use strict';function Overlay(options){options=options||{};this.options=$.extend({},this.defaults,options);return this;}
Overlay.prototype={isOpen:false,defaults:{renderElement:'body',overlayCls:'js--overlay',relativeClass:'js--overlay-relative',openClass:'is--open',closableClass:'is--closable',closeOnClick:true,onClick:$.noop,onClose:$.noop,events:['click','touchstart','MSPointerDown'].join('.overlay')+'.overlay',isScrollable:false,theme:'dark',delay:0},open:function(callback,scope){var me=this,deferred=$.Deferred(),$renderElement=$(me.options.renderElement);me.$overlay=me._generateOverlay();callback=callback||$.noop;scope=scope||me;me._timeout=window.setTimeout(function(){window.clearTimeout(me._timeout);delete me._timeout;$renderElement.addClass(me.options.relativeClass);me.$overlay.appendTo($renderElement);window.setTimeout(function(){me.$overlay.addClass(me.options.openClass);},1);me.isOpen=true;if(me.options.closeOnClick){me.$overlay.addClass(me.options.closableClass);}
deferred.resolve(me,me.$overlay);callback.call(scope,me,me.$overlay);},me.options.delay);me.$overlay.on(me.options.events,$.proxy(me.onOverlayClick,this,me.options));return deferred;},close:function(callback,scope){var me=this,$renderElement=$(me.options.renderElement),deferred=$.Deferred();callback=callback||$.noop;scope=scope||me;if(me._timeout){window.clearTimeout(me._timeout);delete me._timeout;}
if(!me.isOpen){deferred.reject(new Error('No global overlay found.'));return deferred;}
me.isOpen=false;me.$overlay.removeClass(me.options.openClass+' '+me.options.closableClass);if(!$renderElement.hasClass(me.options.relativeClass)){$renderElement.removeClass(me.options.relativeClass);}
me.$overlay.one('transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd',function(){me.$overlay.off(me.options.events).removeAttr('style').remove();deferred.resolve(me);callback.call(scope);});return deferred;},onOverlayClick:function(options){var me=this;if(options){if(typeof options.onClick==='function'){options.onClick.call(me.$overlay);}
if(options.closeOnClick===false){return;}
if(typeof options.onClose==='function'&&options.onClose.call(me.$overlay)===false){return;}}
me.close();},_generateOverlay:function(){var me=this,$overlay=$('<div>',{'class':[me.options.overlayCls,'theme--'+me.options.theme].join(' ')});if(!me.options.isScrollable){return $overlay.on('mousewheel DOMMouseScroll',function(event){event.preventDefault();});}
return $overlay;}};$.overlay={overlay:null,open:function(options,callback,scope){if($.isFunction(options)){callback=options;scope=callback;options={};}
callback=callback||$.noop;options=options||{};scope=scope||this;$.overlay.overlay=new Overlay(options);return $.overlay.overlay.open(callback,scope);},close:function(callback,scope){var deferred=$.Deferred();callback=callback||$.noop;scope=scope||this;if(!$.overlay.overlay){deferred.reject(new Error('No global overlay found.'));return deferred;}
return $.overlay.overlay.close(callback,scope);}};window.Overlay=Overlay;})(jQuery);