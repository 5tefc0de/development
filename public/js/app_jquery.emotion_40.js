;(function($,window,document,undefined){'use strict';var $window=$(window),$body=$('body');$.plugin('swEmotionLoader',{defaults:{controllerUrl:null,availableDevices:null,deviceTypes:{'xl':'0','l':'1','m':'2','s':'3','xs':'4'},wrapperSelector:'.emotion--wrapper',loadingOverlaySelector:'.emotion--overlay'},init:function(){var me=this,opts=me.opts;me.applyDataAttributes();if(opts.controllerUrl===null||opts.availableDevices===null){me.$el.remove();return;}
me.$emotion=false;me.availableDevices=(opts.availableDevices+'').split(',');me.$overlay=$(me.opts.loadingOverlaySelector);me.loadEmotion();me.registerEvents();},registerEvents:function(){var me=this;StateManager.on('resize',$.proxy(me.onDeviceChange,me));$.publish('plugin/swEmotionLoader/onRegisterEvents',[me]);},onDeviceChange:function(){var me=this;me.loadEmotion();$.publish('plugin/swEmotionLoader/onDeviceChange',[me]);},loadEmotion:function(controllerUrl,deviceState){var me=this,devices=me.availableDevices,types=me.opts.deviceTypes,url=controllerUrl||me.opts.controllerUrl,state=deviceState||StateManager.getCurrentState();if(devices.indexOf(types[state])===-1){me.$overlay.remove();me.hideEmotion();return;}
if(!devices.length||!state.length||!url.length){me.$overlay.remove();me.hideEmotion();return;}
if(me.$emotion&&me.$emotion.length){me.$overlay.remove();me.showEmotion();return;}
me.showEmotion();if(me.isLoading){return;}
me.isLoading=true;me.$overlay.insertBefore('.content-main');$.ajax({url:url,method:'GET',success:function(response){me.isLoading=false;me.$overlay.remove();$.publish('plugin/swEmotionLoader/onLoadEmotionLoaded',[me]);if(!response.length){me.hideEmotion();return;}
me.initEmotion(response);$.publish('plugin/swEmotionLoader/onLoadEmotionFinished',[me]);}});$.publish('plugin/swEmotionLoader/onLoadEmotion',[me]);},initEmotion:function(html){var me=this;me.$el.html(html);me.$emotion=me.$el.find('*[data-emotion="true"]');if(!me.$emotion.length){return;}
me.$emotion.swEmotion();$.publish('plugin/swEmotionLoader/onInitEmotion',[me,html]);},showEmotion:function(){var me=this;me.$el.css('display','block');$.publish('plugin/swEmotionLoader/onShowEmotion',[me]);},hideEmotion:function(){var me=this;me.$el.css('display','none');$.publish('plugin/swEmotionLoader/onHideEmotion',[me]);},destroy:function(){var me=this;me._destroy();}});$.plugin('swEmotion',{defaults:{gridMode:'resize',baseWidth:1160,fullscreen:false,columns:4,cellHeight:185,cellSpacing:10,elementSelector:'.emotion--element',gridSizerSelector:'.emotion--sizer',bannerElSelector:'[data-coverImage="true"]',videoElSelector:'.emotion--video'},init:function(){var me=this;me.applyDataAttributes();me.bufferedCall=false;me.$contentMain=$('.content-main');me.$container=me.$el.parents('.content--emotions');me.$wrapper=me.$el.parents('.emotion--wrapper');me.$elements=me.$el.find(me.opts.elementSelector);me.$gridSizer=me.$el.find(me.opts.gridSizerSelector);me.$bannerElements=me.$elements.find(me.opts.bannerElSelector);me.$videoElements=me.$elements.find(me.opts.videoElSelector);me.$productSliderElements=me.$elements.find('*[data-product-slider="true"]');me.remSpacing=~~me.opts.cellSpacing/16;me.currentState=window.StateManager.getCurrentState();if(me.opts.fullscreen){me.initFullscreen();}
me.initState(me.currentState);me.initMode(me.opts.gridMode);me.initElements();me.registerEvents();},initMode:function(gridMode){var me=this,mode=gridMode||me.opts.gridMode,modeMethod='init'+mode.charAt(0).toUpperCase()+mode.slice(1)+'Grid';if(typeof me[modeMethod]==='function'){me[modeMethod]();}else{me.initFluidGrid();}
if(mode!=='resize'){me.setContainerSpacing();}},initState:function(state){var me=this;state=state||window.StateManager.getCurrentState();me.$sizer=me.$el.find('.emotion--sizer-'+state);me.clsPrefix='-'+state;if(me.$sizer.length<=0){me.$sizer=me.$el.find('.emotion--sizer');me.clsPrefix='';}
me.rows=~~me.$sizer.attr('data-rows');},initElements:function(){var me=this;if(me.opts.gridMode!=='rows'){$.each(me.$bannerElements,function(index,item){$(item).swEmotionBanner();});}
$.each(me.$videoElements,function(index,item){$(item).swEmotionVideo();});StateManager.updatePlugin('*[data-product-slider="true"]','swProductSlider');StateManager.updatePlugin('*[data-image-slider="true"]','swImageSlider');window.picturefill();$.publish('plugin/swEmotion/onInitElements',[me]);},initFullscreen:function(){var me=this;$body.addClass('is--no-sidebar');me.$contentMain.addClass('is--fullscreen');me.$wrapper.addClass('is--fullscreen');$.publish('plugin/swEmotion/onInitFullscreen',[me]);},removeFullscreen:function(showSidebar){var me=this;if(showSidebar)$body.removeClass('is--no-sidebar');me.$contentMain.removeClass('is--fullscreen');me.$wrapper.removeClass('is--fullscreen');$.publish('plugin/swEmotion/onRemoveFullscreen',[me,showSidebar]);},initMasonryGrid:function(){var me=this;me.initFluidGrid();$.publish('plugin/swEmotion/onInitMasonryGrid',[me]);},initFluidGrid:function(){var me=this;me.setElementHeights();me.setElementPositions();$.publish('plugin/swEmotion/onInitFluidGrid',[me]);},initResizeGrid:function(){var me=this;me.baseWidth=~~me.opts.baseWidth;me.$el.css('width',me.baseWidth+me.opts.cellSpacing);if(!me.opts.fullscreen){me.$wrapper.css('max-width',me.baseWidth);}
me.setElementHeights();me.setElementPositions();me.scale();$.publish('plugin/swEmotion/onInitScaleGrid',[me]);},initRowsGrid:function(){var me=this,r,c,rowCls,colCls,element,elementCols,lastCol=0,colExp=new RegExp(' col'+me.clsPrefix+'-(\\d)','i'),hiddenElements=$('<div>',{'class':'hidden-elements'}),rows=[];me.$elements.filter('.is--hidden'+me.clsPrefix).appendTo(hiddenElements);for(r=1;r<=me.rows;r++){rows[r]=$('<div>',{'class':'emotion--row row--'+r});lastCol=0;for(c=1;c<=me.opts.columns;c++){rowCls='.start-row'+me.clsPrefix+'-'+r;colCls='.start-col'+me.clsPrefix+'-'+c;element=me.$elements.filter(rowCls+colCls).not('.is--hidden'+me.clsPrefix);if(element.length>0){elementCols=~~(element.attr('class').match(colExp)[1]||1);element.appendTo(rows[r]);if(c-lastCol>1){element.css('margin-left',100/me.opts.columns*(c-lastCol-1)+'%');}else{element.css('margin-left','inherit');}
lastCol=c+elementCols-1;}}}
me.$el.find(':not([data-rows])').remove();hiddenElements.appendTo(me.$el);$.each(rows,function(rowIndex,$row){me.$el.append($row);});$.publish('plugin/swEmotion/onInitRowsGrid',[me,rows,hiddenElements]);},registerEvents:function(){var me=this;window.StateManager.on('resize',$.proxy(me.onResize,me));if(me.opts.fullscreen){$.subscribe('plugin/swEmotionLoader/onShowEmotion',$.proxy(me.onShow,me));$.subscribe('plugin/swEmotionLoader/onHideEmotion',$.proxy(me.onHide,me));}
$.publish('plugin/swEmotion/onRegisterEvents',[me]);},onResize:function(){var me=this,state=window.StateManager.getCurrentState();me.initState(state);if(me.opts.gridMode==='resize'){me.scale();}
if(me.opts.gridMode==='resize'||me.opts.gridMode==='fluid'){me.setElementHeights();me.setElementPositions();}
if(me.opts.gridMode==='rows'&&me.currentState!==state){me.initRowsGrid();}
me.$bannerElements.trigger('emotionResize');me.$videoElements.trigger('emotionResize');me.currentState=state;$.publish('plugin/swEmotion/onResize',[me,me.currentState]);},onShow:function(event,emotion){var me=this;if(emotion.$el.is(me.$el)){me.initFullscreen();}
$.publish('plugin/swEmotion/onShow',[me,event,emotion]);},onHide:function(event,emotion){var me=this;if(emotion.$el.is(me.$el)){me.removeFullscreen();}
$.publish('plugin/swEmotion/onHide',[me,event,emotion]);},setContainerSpacing:function(){var me=this;me.$el.css({'margin-left':-me.remSpacing+'rem'});$.publish('plugin/swEmotion/onSetContainerSpacing',[me]);},setElementPositions:function(){var me=this,i=1;for(i;i<=me.rows;i++){var top=100/me.rows*(i-1);me.$elements.filter('.start-row'+me.clsPrefix+'-'+i).css('top',top+'%');}
$.publish('plugin/swEmotion/onSetElementPositions',[me]);},setElementHeights:function(){var me=this,i=1;for(i;i<=me.rows;i++){var height=100/me.rows*i;me.$elements.filter('.row'+me.clsPrefix+'-'+i).css('height',height+'%');}
$.publish('plugin/swEmotion/onSetElementHeights',[me]);},scale:function(){var me=this,width=(me.opts.fullscreen)?$window.outerWidth():me.$wrapper.outerWidth(),ratio=me.baseWidth/me.$el.outerHeight(),factor=width/me.baseWidth,containerStyle=me.$el.get(0).style,wrapperHeight=width/ratio;$.extend(containerStyle,{'MsTransform':'scale('+factor+') translateX('+-me.remSpacing+'rem)','OTransform':'scale('+factor+') translateX('+-me.remSpacing+'rem)','MozTransform':'scale('+factor+') translateX('+-me.remSpacing+'rem)','webkitTransform':'scale('+factor+') translateX('+-me.remSpacing+'rem)','transform':'scale('+factor+') translateX('+-me.remSpacing+'rem)'});me.$wrapper.css('height',wrapperHeight);$.publish('plugin/swEmotion/onScale',[me,width,factor,wrapperHeight]);},buffer:function(func,bufferTime){var me=this;window.clearTimeout(me.bufferedCall);me.bufferedCall=window.setTimeout($.proxy(func,me),bufferTime);$.publish('plugin/swEmotion/onBuffer',[me,me.bufferedCall,func,bufferTime]);},destroy:function(){var me=this;me._destroy();}});$.plugin('swEmotionBanner',{defaults:{width:null,height:null,containerSelector:'.banner--content'},init:function(){var me=this;me.applyDataAttributes();me.$container=me.$el.find(me.opts.containerSelector);me.imageRatio=me.opts.width/me.opts.height;me.resizeBanner();me.registerEvents();},registerEvents:function(){var me=this;me._on(me.$el,'emotionResize',$.proxy(me.resizeBanner,me));$.publish('plugin/swEmotionBanner/onRegisterEvents',[me]);},resizeBanner:function(){var me=this,containerWidth=me.$el.width(),containerHeight=me.$el.height(),containerRatio=containerWidth/containerHeight,orientation=me.imageRatio>containerRatio,bannerWidth=orientation?containerHeight*me.imageRatio:'100%',bannerHeight=orientation?'100%':containerWidth/me.imageRatio;me.$container.css({'width':bannerWidth,'height':bannerHeight});$.publish('plugin/swEmotionBanner/onResizeBanner',[me]);},destroy:function(){var me=this;me._destroy();}});$.plugin('swEmotionVideo',{defaults:{mode:'cover',scaleOriginX:50,scaleOriginY:50,scale:1,playIconCls:'icon--play',pauseIconCls:'icon--pause',videoSelector:'.video--element',coverSelector:'.video--cover',playBtnSelector:'.video--play-btn',playIconSelector:'.video--play-icon'},init:function(){var me=this;me.applyDataAttributes();me.$video=me.$el.find(me.opts.videoSelector);me.$videoCover=me.$el.find(me.opts.coverSelector);me.$playBtn=me.$el.find(me.opts.playBtnSelector);me.$playBtnIcon=me.$playBtn.find(me.opts.playIconSelector);me.player=me.$video.get(0);if(me.$video.attr('muted')!==undefined){me.player.volume=0.0;}
me.setScaleOrigin(me.opts.scaleOriginX,me.opts.scaleOriginY);me.registerEvents();},registerEvents:function(){var me=this;me._on(me.$video,'loadedmetadata',$.proxy(me.onLoadMeta,me));me._on(me.$video,'canplay',$.proxy(me.onCanPlay,me));me._on(me.$video,'play',$.proxy(me.onVideoPlay,me));me._on(me.$video,'ended',$.proxy(me.onVideoEnded,me));me._on(me.$el,'emotionResize',$.proxy(me.resizeVideo,me));me._on(me.$videoCover,'click',$.proxy(me.onPlayClick,me));me._on(me.$playBtn,'click',$.proxy(me.onPlayClick,me));$.publish('plugin/swEmotionVideo/onRegisterEvents',[me]);},onLoadMeta:function(event){var me=this;me.videoWidth=me.player.videoWidth;me.videoHeight=me.player.videoHeight;me.videoRatio=me.videoWidth/me.videoHeight;me.resizeVideo();$.publish('plugin/swEmotionVideo/onLoadMeta',[me,event]);},onCanPlay:function(event){var me=this;if(!me.player.paused||me.player.autoplay){me.$playBtnIcon.addClass(me.opts.pauseIconCls).removeClass(me.opts.playIconCls);}
$.publish('plugin/swEmotionVideo/onCanPlay',[me,event]);},onVideoPlay:function(event){var me=this;me.$videoCover.hide();$.publish('plugin/swEmotionVideo/onVideoPlay',[me,event]);},onVideoEnded:function(event){var me=this;me.$playBtnIcon.removeClass(me.opts.pauseIconCls).addClass(me.opts.playIconCls);$.publish('plugin/swEmotionVideo/onVideoEnded',[me,event]);},onPlayClick:function(event){var me=this;event.preventDefault();(me.player.paused)?me.playVideo():me.stopVideo();$.publish('plugin/swEmotionVideo/onPlayClick',[me,event]);},playVideo:function(){var me=this;me.$playBtnIcon.addClass(me.opts.pauseIconCls).removeClass(me.opts.playIconCls);me.player.play();$.publish('plugin/swEmotionVideo/onPlayVideo',[me]);},stopVideo:function(){var me=this;me.$playBtnIcon.removeClass(me.opts.pauseIconCls).addClass(me.opts.playIconCls);me.player.pause();$.publish('plugin/swEmotionVideo/onStopVideo',[me]);},resizeVideo:function(){var me=this;if(me.opts.mode==='scale'){return;}
var containerWidth=me.$el.outerWidth(),containerHeight=me.$el.outerHeight(),containerRatio=containerWidth/containerHeight,orientation=me.videoRatio>containerRatio,positiveFactor=me.videoRatio/containerRatio,negativeFactor=containerRatio/me.videoRatio;if(me.opts.mode==='stretch'){if(orientation){me.transformVideo('scaleY('+positiveFactor*me.opts.scale+')');}else{me.transformVideo('scaleX('+negativeFactor*me.opts.scale+')');}}
if(me.opts.mode==='cover'){if(orientation){me.transformVideo('scaleX('+positiveFactor*me.opts.scale+') scaleY('+positiveFactor*me.opts.scale+')');}else{me.transformVideo('scaleX('+negativeFactor*me.opts.scale+') scaleY('+negativeFactor*me.opts.scale+')');}}
$.publish('plugin/swEmotionVideo/onResizeVideo',[me]);},setScaleOrigin:function(originX,originY){var me=this,x=originX||me.opts.scaleOriginX,y=originY||me.opts.scaleOriginY,origin=x+'% '+y+'%';me.$video.css({'-ms-transform-origin':origin,'-o-transform-origin':origin,'-moz-transform-origin':origin,'-webkit-transform-origin':origin,'transform-origin':origin});$.publish('plugin/swEmotionVideo/onSetScaleOrigin',[me,x,y]);},transformVideo:function(transformation){var me=this,videoElementStyle=me.player.style;$.extend(videoElementStyle,{'MsTransform':transformation,'OTransform':transformation,'MozTransform':transformation,'webkitTransform':transformation,'transform':transformation});$.publish('plugin/swEmotionVideo/onTransformVideo',[me,transformation]);},destroy:function(){var me=this;me._destroy();}});})(jQuery,window,document);