;(function($,window,StateManager,undefined){'use strict';var $body=$('body');$.plugin('swListingActions',{defaults:{filterFormSelector:'*[data-filter-form="true"]',filterComponentSelector:'*[data-filter-type]',filterTriggerSelector:'*[data-filter-trigger="true"]',filterTriggerIconSelector:'.action--collapse-icon',filterContainerSelector:'.action--filter-options',filterInnerContainerSelector:'.filter--container',actionFormSelector:'*[data-action-form="true"]',actionLinkSelector:'*[data-action-link="true"]',activeFilterContSelector:'.filter--active-container',applyFilterBtnSelector:'.filter--btn-apply',activeFilterCls:'filter--active',activeFilterIconCls:'filter--active-icon',collapsedCls:'is--collapsed',hasActiveFilterCls:'is--active-filter',activeCls:'is--active',disabledCls:'is--disabled',filterCountSelector:'.filter--count',loadingClass:'is--loading',propertyPrefixChar:'__',bufferTime:850,animationSpeed:400,instantFilterActiveCls:'is--instant-filter-active',listingSelector:'.listing--container > .listing',paginationSelector:'.listing--paging.panel--paging',infiniteScrollingAttribute:'data-infinite-scrolling',paginationBarPerPageSelector:'.per-page--field.action--field',pageInputSelector:'input[name=p]',sortInputSelector:'input[name=o]',perPageInputSelector:'input[name=n]',sortActionFormSelector:'.action--sort',perPageActionFormSelector:'.action--per-page',listingWrapperSelector:'.listing--wrapper',loadingIndSelector:'.listing--wrapper',noResultContainerSelector:'.listing-no-filter-result .alert',isLoadingCls:'is--loading',loadingIndConfig:{theme:'light',animationSpeed:100,closeOnClick:false},filterCloseBtnSelector:'.filter--close-btn',closeFilterOffCanvasBtnIcon:'<i class="icon--arrow-right"></i>',searchHeadlineProductCountSelector:'.search--headline .headline--product-count',filterFacetContainerSelector:'.filter--facet-container',filterActionButtonBottomSelector:'.filter--actions.filter--actions-bottom',sidebarLoadingIndicatorParentSelector:'.content-main--inner'},init:function(){var me=this,filterCount;me.applyDataAttributes();me.$filterForm=$(me.opts.filterFormSelector);me.$filterComponents=me.$filterForm.find(me.opts.filterComponentSelector);me.$filterTrigger=me.$el.find(me.opts.filterTriggerSelector);me.$filterTriggerIcon=me.$filterTrigger.find(me.opts.filterTriggerIconSelector);me.$filterCont=$(me.opts.filterContainerSelector);me.$actionForms=$(me.opts.actionFormSelector);me.$actionLinks=$(me.opts.actionLinkSelector);me.$activeFilterCont=me.$filterForm.find(me.opts.activeFilterContSelector);me.$applyFilterBtn=me.$filterForm.find(me.opts.applyFilterBtnSelector);me.$listing=$(me.opts.listingSelector);me.$pageInput=$(me.$filterForm.find(me.opts.pageInputSelector));me.$sortInput=$(me.$filterForm.find(me.opts.sortInputSelector));me.$perPageInput=$(me.$filterForm.find(me.opts.perPageInputSelector));me.$listingWrapper=me.$el.parent(me.opts.listingWrapperSelector);me.$closeFilterOffCanvasBtn=$(me.opts.filterCloseBtnSelector);me.$filterFacetContainer=me.$filterForm.find(me.opts.filterFacetContainerSelector);me.$filterActionButtonBottom=me.$filterForm.find(me.opts.filterActionButtonBottomSelector);me.$sidebarModeLoadionIndicator=$(me.opts.sidebarLoadingIndicatorParentSelector);me.$noFilterResultContainer=$(me.opts.noResultContainerSelector);me.searchHeadlineProductCount=$(me.opts.searchHeadlineProductCountSelector);me.listingUrl=me.$filterForm.attr('data-listing-url');me.loadFacets=$.parseJSON(me.$filterForm.attr('data-load-facets'));me.showInstantFilterResult=$.parseJSON(me.$filterForm.attr('data-instant-filter-result'));me.isInfiniteScrolling=me.$listing.attr(me.opts.infiniteScrollingAttribute);me.isFilterpanelInSidebar=$.parseJSON(me.$filterForm.attr('data-is-in-sidebar'));me.controllerURL=window.location.href.split('?')[0];me.resetLabel=me.$activeFilterCont.attr('data-reset-label');me.propertyFieldNames=[];me.activeFilterElements={};me.categoryParams={};me.urlParams='';me.bufferTimeout=0;me.closeFilterOffCanvasBtnText=me.$closeFilterOffCanvasBtn.html();me.closeFilterOffCanvasBtnTextWithProducts=me.$closeFilterOffCanvasBtn.attr('data-show-products-text');me.getPropertyFieldNames();me.setCategoryParamsFromTopLocation();me.createActiveFiltersFromCategoryParams();me.createUrlParams();filterCount=Object.keys(me.activeFilterElements).length;me.updateFilterTriggerButton(filterCount>1?filterCount-1:filterCount);me.initStateHandling();me.registerEvents();me.$loadingIndicatorElement=$(me.opts.loadingIndSelector);me.$offCanvasLoadingIndicator=$(me.opts.filterInnerContainerSelector);$.subscribe('action/fetchListing',$.proxy(me.onSendListingRequest,me));me.disableActiveFilterContainer(true);var isFiltered=me.$filterForm.attr('data-is-filtered');if(isFiltered>0&&me.loadFacets){me.getFilterResult(me.urlParams,true,false);}},initStateHandling:function(){var me=this,enterFn=$.proxy(me.onEnterMobile,me),exitFn=$.proxy(me.onExitMobile,me);StateManager.registerListener([{state:'xs',enter:enterFn,exit:exitFn},{state:'s',enter:enterFn,exit:exitFn}]);$.publish('plugin/swListingActions/onInitStateHandling',[me]);},onEnterMobile:function(){var me=this,opts=me.opts;me.$filterForm.removeAttr('style');me.$filterFacetContainer.removeAttr('style');me.$filterActionButtonBottom.removeAttr('style');me.disableActiveFilterContainer(false);me.$filterCont.removeClass(opts.collapsedCls);me.$filterTrigger.removeClass(opts.activeCls);$.publish('plugin/swListingActions/onEnterMobile',[me]);},disableActiveFilterContainer:function(disabled){var me=this;if(me.showInstantFilterResult||me.isFilterpanelInSidebar){return;}
if(disabled){me.$activeFilterCont.addClass(me.opts.disabledCls);}else if(me.$activeFilterCont.hasClass(me.opts.disabledCls)){me.$activeFilterCont.removeClass(me.opts.disabledCls);}},onExitMobile:function(){var me=this;if(StateManager.isCurrentState(['xs','s'])){return;}
if(Object.keys(me.activeFilterElements).length&&!me.isFilterpanelInSidebar){me.disableActiveFilterContainer(true);}
$.publish('plugin/swListingActions/onExitMobile',[me]);},registerEvents:function(){var me=this;me._on(me.$filterForm,'submit',$.proxy(me.onFilterSubmit,me));me._on(me.$actionForms,'submit',$.proxy(me.onActionSubmit,me));me._on(me.$actionLinks,'click',$.proxy(me.onActionLink,me));me._on(me.$filterComponents,'onChange',$.proxy(me.onComponentChange,me));me._on(me.$filterTrigger,'click',$.proxy(me.onFilterTriggerClick,me));me._on($body,'click',$.proxy(me.onBodyClick,me));me.$activeFilterCont.on(me.getEventName('click'),'.'+me.opts.activeFilterCls,$.proxy(me.onActiveFilterClick,me));me.$listingWrapper.on(me.getEventName('submit'),me.opts.actionFormSelector,$.proxy(me.onActionSubmit,me));me.$listingWrapper.on(me.getEventName('click'),me.opts.actionLinkSelector,$.proxy(me.onActionLink,me));$.publish('plugin/swListingActions/onRegisterEvents',[me]);},onFilterSubmit:function(event){event.preventDefault();var me=this,formData=me.$filterForm.serializeArray(),categoryParams=me.setCategoryParamsFromData(formData);me.applyCategoryParams(categoryParams);$.publish('plugin/swListingActions/onFilterSubmit',[me,event]);},onActionSubmit:function(event){event.preventDefault();var me=this,$form=$(event.currentTarget),formData=$form.serializeArray(),categoryParams=me.setCategoryParamsFromData(formData,true);if(me.showInstantFilterResult){me.setPageInput(me.getFormValue(formData,'p'));if(me.isSortAction($form)){me.setSortInput(me.getFormValue(formData,'o'));}else if(me.isPerPageAction($form)){me.setPerPageInput(me.getFormValue(formData,'n'));}}
me.applyCategoryParams(categoryParams);$.publish('plugin/swListingActions/onActionSubmit',[me,event]);},getFormValue:function(data,key){var value='';$.each(data,function(index,item){if(item.name==key){value=item.value;return;}});return value;},isSortAction:function($form){var me=this;return $form.is(me.opts.sortActionFormSelector);},isPerPageAction:function($form){var me=this;return $form.is(me.opts.perPageActionFormSelector);},setPageInput:function(value){var me=this;me.$pageInput.val(value);},setSortInput:function(value){var me=this;me.$sortInput.val(value);},setPerPageInput:function(value){var me=this;me.$perPageInput.val(value);},onActionLink:function(event){event.preventDefault();var me=this,$link=$(event.currentTarget),linkParams=$link.attr('href').split('?')[1],linkParamsArray=linkParams.split('');if(me.showInstantFilterResult&&linkParamsArray[0]==='p'){linkParamsArray=linkParams.split('=');me.setPageInput(linkParamsArray[1]);}
me.applyCategoryParams(me.setCategoryParamsFromUrlParams(linkParams));$.publish('plugin/swListingActions/onActionLink',[me,event]);},onFilterTriggerClick:function(event){event.preventDefault();if(StateManager.isCurrentState(['xs','s'])){return;}
var me=this;if(me.$filterCont.hasClass(me.opts.collapsedCls)){me.closeFilterPanel();}else{me.openFilterPanel();}
$.publish('plugin/swListingActions/onFilterTriggerClick',[me,event]);},onBodyClick:function(event){var me=this,$target=$(event.target);if(!$target.is(me.opts.filterComponentSelector+', '+me.opts.filterComponentSelector+' *')){$.each(me.$filterComponents,function(index,item){$(item).data('plugin_swFilterComponent').close();});}
$.publish('plugin/swListingActions/onBodyClick',[me,event]);},onComponentChange:function(event){var me=this,urlParams,formData,categoryParams;if(me.showInstantFilterResult){me.setPageInput(1);}
formData=me.$filterForm.serializeArray();categoryParams=me.setCategoryParamsFromData(formData);urlParams=me.createUrlParams(categoryParams);me.createActiveFiltersFromCategoryParams(categoryParams);me.enableButtonLoading();me.buffer($.proxy(me.getFilterResult,me,urlParams,me.loadFacets,me.showInstantFilterResult),me.opts.bufferTime);$.publish('plugin/swListingActions/onComponentChange',[me,event]);},onActiveFilterClick:function(event){var me=this,$activeFilter=$(event.currentTarget),param=$activeFilter.attr('data-filter-param'),isMobile=StateManager.isCurrentState(['xs','s']);if(param=='reset'){$.each(me.activeFilterElements,function(key){me.removeActiveFilter(key);me.resetFilterProperty(key);});if(!isMobile&&!me.$filterCont.hasClass(me.opts.collapsedCls)){me.applyCategoryParams();}}else if(!me.$activeFilterCont.hasClass(me.opts.disabledCls)){me.removeActiveFilter(param);me.resetFilterProperty(param);}
$.publish('plugin/swListingActions/onActiveFilterClick',[me,event]);},getPropertyFieldNames:function(){var me=this;$.each(me.$filterComponents,function(index,item){var $comp=$(item),types=['value-list','value-list-single','value-tree','media','value-tree-single'],type=$comp.attr('data-filter-type'),fieldName=$comp.attr('data-field-name');if(types.indexOf(type)>=0&&me.propertyFieldNames.indexOf(fieldName)==-1){me.propertyFieldNames.push(fieldName);}});$.publish('plugin/swListingActions/onGetPropertyFieldNames',[me,me.propertyFieldNames]);return me.propertyFieldNames;},setCategoryParamsFromData:function(formData,extend){var me=this,tempParams={};$.each(formData,function(index,item){if(item['value']){tempParams[item['name']]=item['value'];}});if(extend){return $.extend(me.categoryParams,tempParams);}
me.categoryParams=tempParams;$.publish('plugin/swListingActions/onSetCategoryParamsFromData',[me,tempParams]);return tempParams;},setCategoryParamsFromTopLocation:function(){var me=this,urlParams=window.location.search.substr(1),categoryParams=me.setCategoryParamsFromUrlParams(urlParams);$.publish('plugin/swListingActions/onSetCategoryParamsFromData',[me,categoryParams]);return categoryParams;},setCategoryParamsFromUrlParams:function(urlParamString){var me=this,categoryParams,params;if(urlParamString.length<=0){categoryParams={};$.publish('plugin/swListingActions/onSetCategoryParamsFromUrlParams',[me,categoryParams]);return categoryParams;}
categoryParams=me.categoryParams;params=urlParamString.split('&');$.each(params,function(index,item){var param=item.split('=');param=$.map(param,function(val){val=val.replace(/\+/g,'%20');return decodeURIComponent(val);});if(param[1]=='reset'){delete categoryParams[param[0]];}else if(me.propertyFieldNames.indexOf(param[0])!=-1){var properties=param[1].split('|');$.each(properties,function(index,property){categoryParams[me.opts.propertyPrefixChar+param[0]+me.opts.propertyPrefixChar+property]=property;});}else{categoryParams[param[0]]=param[1];}});$.publish('plugin/swListingActions/onSetCategoryParamsFromUrlParams',[me,categoryParams]);return categoryParams;},applyCategoryParams:function(categoryParams){var me=this,params=categoryParams||me.categoryParams,urlParams=me.createUrlParams(params);me.applyUrlParams(urlParams);$.publish('plugin/swListingActions/onApplyCategoryParams',[me,categoryParams]);},createUrlParams:function(categoryParams){var me=this,catParams=categoryParams||me.categoryParams,params=me.cleanParams(catParams),filterList=[];$.each(params,function(key,value){filterList.push(encodeURIComponent(key)+'='+encodeURIComponent(value));});me.urlParams='?'+filterList.join('&');$.publish('plugin/swListingActions/onCreateUrlParams',[me,me.urlParams]);return me.urlParams;},cleanParams:function(params){var me=this,propertyParams={};$.each(params,function(key,value){if(key.substr(0,2)==me.opts.propertyPrefixChar){var propertyKey=key.split(me.opts.propertyPrefixChar)[1];if(propertyParams[propertyKey]!==undefined){propertyParams[propertyKey]+='|'+value;}else{propertyParams[propertyKey]=value;}}else{propertyParams[key]=value;}});return propertyParams;},applyUrlParams:function(urlParams){var me=this,params=urlParams||me.urlParams,formData,categoryParams,paramsForFilterResult;if(me.showInstantFilterResult){formData=me.$filterForm.serializeArray();categoryParams=me.setCategoryParamsFromData(formData);paramsForFilterResult=me.createUrlParams(categoryParams);me.enableButtonLoading();me.buffer($.proxy(me.getFilterResult,me,paramsForFilterResult,false,me.showInstantFilterResult),me.opts.bufferTime);}else{window.location.href=me.getListingUrl(params,false);}
$.publish('plugin/swListingActions/onApplyUrlParams',[me,urlParams]);},getListingUrl:function(urlParams,encode){var me=this,params=urlParams||me.urlParams,url;if(encode){url=encodeURI(me.controllerURL+params);}else{url=me.controllerURL+params;}
$.publish('plugin/swListingActions/onGetListingUrl',[me,url,urlParams,encode]);return url;},buffer:function(func,bufferTime){var me=this;if(me.bufferTimeout){clearTimeout(me.bufferTimeout);}
me.bufferTimeout=setTimeout(func,bufferTime);$.publish('plugin/swListingActions/onBuffer',[me,me.bufferTimeout,func,bufferTime]);},resetBuffer:function(){var me=this;me.bufferTimeout=0;$.publish('plugin/swListingActions/onResetBuffer',[me,me.bufferTimeout]);},onSendListingRequest:function(event,params,loadFacets,loadProducts,callback){var me=this,formData=me.$filterForm.serializeArray();$.each(formData,function(index,item){if(!params.hasOwnProperty(item.name)){params[item.name]=item.value;}});me.sendListingRequest(params,loadFacets,loadProducts,callback,true);},sendListingRequest:function(params,loadFacets,loadProducts,callback,appendDefaults){var me=this;if(typeof params=='object'){params='?'+$.param(params);}
me.resetBuffer();$.ajax({type:'get',url:me.buildListingUrl(params,loadFacets,loadProducts),success:$.proxy(callback,me)});$.publish('plugin/swListingActions/onGetFilterResult',[me,params]);},getFilterResult:function(urlParams,loadFacets,loadProducts){var me=this,params=urlParams||me.urlParams,loadingIndicator=me.$loadingIndicatorElement;if(me.$filterCont.is('.off-canvas.is--open')){loadingIndicator=me.$offCanvasLoadingIndicator;}else if(me.isFilterpanelInSidebar){loadingIndicator=me.$sidebarModeLoadionIndicator;}
me.resetBuffer();me.enableLoading(loadingIndicator,loadProducts,function(){me.sendListingRequest(params,loadFacets,loadProducts,function(response){me.disableLoading(loadingIndicator,loadProducts,response,function(){me.updateListing(response);$.publish('plugin/swListingActions/onGetFilterResultFinished',[me,response,params]);});});});},enableLoading:function(loadingIndicator,loadProducts,callback){var me=this;callback=$.isFunction(callback)?callback:$.noop;if(loadProducts){me.$listing.addClass(me.opts.isLoadingCls);loadingIndicator.setLoading(true,me.opts.loadingIndConfig).then($.proxy(callback,me));}else{me.enableButtonLoading();callback.call(me);}},enableButtonLoading:function(){var me=this;if(!me.showInstantFilterResult){me.$applyFilterBtn.addClass(me.opts.loadingClass);}},disableLoading:function(loadingIndicator,loadProducts,response,callback){var me=this;callback=$.isFunction(callback)?callback:$.noop;if(loadProducts){loadingIndicator.setLoading(false).then($.proxy(callback,me));}else{me.$applyFilterBtn.removeClass(me.opts.loadingClass);me.updateFilterButton(response.totalCount);callback.call(me);}},buildListingUrl:function(formParams,loadFacets,loadProducts){var me=this,url;url=me.listingUrl+formParams;if(loadProducts){url+='&loadProducts=1';}
if(loadFacets){url+='&loadFacets=1';}
return url;},updateListing:function(response){var me=this,html,pages;if(!response.hasOwnProperty('listing')){me.$listing.removeClass(me.opts.isLoadingCls);return;}
me.updateFilterCloseButton(response.totalCount);me.updateSearchHeadline(response.totalCount);me.updateNoResultContainer(response.totalCount);html=response.listing.trim();me.$listing.html(html);me.$listing.removeClass(me.opts.isLoadingCls);window.history.pushState('data','',window.location.href.split('?')[0]+me.urlParams);$.publish('plugin/swListingActions/updateListing',[me,html]);if(me.isInfiniteScrolling){pages=Math.ceil(response.totalCount/me.$perPageInput.val());me.$listing.attr('data-pages',pages);me.$listing.data('plugin_swInfiniteScrolling').destroy();StateManager.addPlugin(me.opts.listingSelector,'swInfiniteScrolling');$.publish('plugin/swListingActions/updateInfiniteScrolling',[me,html,pages]);}else{me.updatePagination(response);}},updateFilterCloseButton:function(totalCount){var me=this,filterCount=Object.keys(me.activeFilterElements).length;if(filterCount>0){me.$closeFilterOffCanvasBtn.html(me.closeFilterOffCanvasBtnTextWithProducts.replace('%s',totalCount)+me.opts.closeFilterOffCanvasBtnIcon);$.publish('plugin/swListingActions/updateFilterCloseBtnWithProductsCount',[me,totalCount]);}else{me.$closeFilterOffCanvasBtn.html(me.closeFilterOffCanvasBtnText);$.publish('plugin/swListingActions/updateFilterCloseBtnDefault',[me]);}
me.updateFilterTriggerButton(filterCount>1?filterCount-1:filterCount);},updateSearchHeadline:function(totalCount){var me=this;if(me.searchHeadlineProductCount.length>0){me.searchHeadlineProductCount.html(totalCount);}},updateNoResultContainer:function(totalCount){var me=this;if(totalCount>0){if(!me.$noFilterResultContainer.hasClass('is--hidden')){me.$noFilterResultContainer.addClass('is--hidden');}
return;}
if(me.$noFilterResultContainer.hasClass('is--hidden')){me.$noFilterResultContainer.removeClass('is--hidden');}},updatePagination:function(response){var me=this,html=response.pagination.trim();$(me.opts.paginationSelector).replaceWith(html);StateManager.updatePlugin(me.opts.paginationBarPerPageSelector,'swAutoSubmit');$.publish('plugin/swListingActions/updatePagination',[me,html]);},updateFilterButton:function(count){var me=this;me.$applyFilterBtn.find(me.opts.filterCountSelector).html(count);if(count<=0){me.$applyFilterBtn.attr('disabled','disabled');}else{me.$applyFilterBtn.removeAttr('disabled');}
$.publish('plugin/swListingActions/onUpdateFilterButton',[me,count]);},updateFilterTriggerButton:function(activeFilterCount){var me=this;me.$filterTriggerIcon.html(activeFilterCount||'');$.publish('plugin/swListingActions/onUpdateFilterTriggerButton',[me,activeFilterCount]);},createActiveFiltersFromCategoryParams:function(categoryParams){var me=this,count=0,params=categoryParams||me.categoryParams;$.each(me.activeFilterElements,function(key){if(params[key]===undefined||params[key]==0){me.removeActiveFilter(key);}});$.each(params,function(key,value){me.createActiveFilter(key,value);});$.each(me.activeFilterElements,function(){count++;});if(count>1){me.createActiveFilterElement('reset',me.resetLabel);}
me.$filterCont.toggleClass(me.opts.hasActiveFilterCls,(count>0));if(me.showInstantFilterResult&&count>0){me.$filterCont.addClass(me.opts.instantFilterActiveCls);}
if(!me.opts.isFilterpanelInSidebar){me.$activeFilterCont.toggleClass(me.opts.collapsedCls,me.$filterCont.hasClass(me.opts.collapsedCls));}
$.publish('plugin/swListingActions/onCreateActiveFiltersFromCategoryParams',[me,categoryParams]);},createActiveFilter:function(param,value){var me=this,label=me.createActiveFilterLabel(param,value);if(label!==undefined&&label.length){if(me.activeFilterElements[param]!==undefined){me.updateActiveFilterElement(param,label);}else{me.createActiveFilterElement(param,label);}}
$.publish('plugin/swListingActions/onCreateActiveFilter',[me,param,value]);},createActiveFilterElement:function(param,label){var me=this;me.activeFilterElements[param]=$('<span>',{'class':me.opts.activeFilterCls,'html':me.getLabelIcon()+label,'data-filter-param':param}).appendTo(me.$activeFilterCont);$.publish('plugin/swListingActions/onCreateActiveFilterElement',[me,param,label]);},updateActiveFilterElement:function(param,label){var me=this;me.activeFilterElements[param].html(me.getLabelIcon()+label);$.publish('plugin/swListingActions/onUpdateActiveFilterElement',[me,param,label]);},removeActiveFilter:function(param){var me=this;me.activeFilterElements[param].remove();delete me.activeFilterElements[param];$.publish('plugin/swListingActions/onRemoveActiveFilter',[me,param]);},resetFilterProperty:function(param){var me=this,$input,rangeSlider;if(param=='rating'){$input=me.$filterForm.find('.filter--rating .is--active input[name="rating"]');$input.removeAttr('checked').trigger('change');}else{$input=me.$filterForm.find('[name="'+me.escapeDoubleQuotes(param)+'"]');if($input.is('[data-range-input]')){rangeSlider=$input.parents('[data-range-slider="true"]').data('plugin_swRangeSlider');rangeSlider.reset($input.attr('data-range-input'));}else{$input.removeAttr('checked').trigger('change');}}
$.publish('plugin/swListingActions/onResetFilterProperty',[me,param]);},createActiveFilterLabel:function(param,value){var me=this,$label,labelText='',valueString=value+'';if(param=='rating'&&value>0){labelText=me.createStarLabel(value);}else{$label=me.$filterForm.find('label[for="'+me.escapeDoubleQuotes(param)+'"]');if($label.is('[data-range-label]')){labelText=$label.prev('span').html()+$label.html();}else if($label.find('img').length){labelText=$label.find('img').attr('alt');}else if(value>0||valueString.length>0){labelText=$label.html();}}
$.publish('plugin/swListingActions/onCreateActiveFilterLabel',[me,labelText,param,value]);return labelText;},escapeDoubleQuotes:function(str){return str.replace(/\\([\s\S])|(")/g,'\\$1$2');},createStarLabel:function(stars){var me=this,label='',i=0;for(i;i<5;i++){if(i<stars){label+='<i class="icon--star"></i>';}else{label+='<i class="icon--star-empty"></i>';}}
$.publish('plugin/swListingActions/onCreateStarLabel',[me,label,stars]);return label;},getLabelIcon:function(){var me=this,icon='<span class="'+me.opts.activeFilterIconCls+'"></span>';$.publish('plugin/swListingActions/onCreateStarLabel',[me,icon]);return icon;},openFilterPanel:function(){var me=this;if(!me.$filterCont.hasClass(me.opts.hasActiveFilterCls)){me.$activeFilterCont.slideDown(me.opts.animationSpeed);}
me.$filterFacetContainer.slideDown(me.opts.animationSpeed);me.$filterActionButtonBottom.slideDown(me.opts.animationSpeed);me.disableActiveFilterContainer(false);me.$filterCont.addClass(me.opts.collapsedCls);me.$filterTrigger.addClass(me.opts.activeCls);$.publish('plugin/swListingActions/onOpenFilterPanel',[me]);},closeFilterPanel:function(){var me=this;if(!me.$filterCont.hasClass(me.opts.hasActiveFilterCls)){me.$activeFilterCont.slideUp(me.opts.animationSpeed);}
me.$filterFacetContainer.slideUp(me.opts.animationSpeed);me.$filterActionButtonBottom.slideUp(me.opts.animationSpeed);me.disableActiveFilterContainer(true);me.$filterCont.removeClass(me.opts.collapsedCls);me.$filterTrigger.removeClass(me.opts.activeCls);$.publish('plugin/swListingActions/onCloseFilterPanel',[me]);},destroy:function(){var me=this;me.$el.off(me.getEventName('click'),'.'+me.opts.activeFilterCls);me.$listingWrapper.off(me.getEventName('submit'),me.opts.actionFormSelector);me.$listingWrapper.off(me.getEventName('click'),me.opts.actionLinkSelector);me._destroy();}});})(jQuery,window,StateManager,undefined);